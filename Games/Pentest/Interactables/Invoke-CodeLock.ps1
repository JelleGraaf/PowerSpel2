function Invoke-CodeLock {
    <#
    .SYNOPSIS
        Starts the interactable code lock.
        
    .DESCRIPTION
        Starts the interactable code lock. It allows the player open a door with a four digit code.
    #>

    # Import machine data from file.
    $InteractableData = Get-Content "$PSScriptRoot\CodeLock.json" | ConvertFrom-Json -AsHashtable
    
    $Script:MachineState = "Running"
    $AttemptCounter = 0
    while ($Script:MachineState -eq "Running") {

        # Write header to screen.
        Show-Header

        # Write map to screen, if enabled.
        if ($MapStyle) {
            Show-Map -MapStyle $MapStyle
        }
    
        # Write previous action to screen, if any.
        if ($ActionMessage) {
            Write-WordWrapHost $ActionMessage -Color Green
            if (!$CompletedAchievement) { Write-Host } # Skip this empty line when an achievement is completed, it looks better that way.
        }
        # Write room title to screen.
        Write-Host "[$($World."$($State.CurrentRoom)".RoomTitle)]" -BackgroundColor White -ForegroundColor Black
        Write-Host
    
        # Write room description to screen.
        Write-WordWrapHost "$($World."$($State.CurrentRoom)".RoomDescription)"

        # Write exits to screen.
        Show-Exits

        # Take inventory of all the options at the code lock.
        $CodeLockOptions = @{}
        $i = 1
        foreach ($Option in $InteractableData.Keys) {
            $CodeLockOptions.$i = $InteractableData.$Option
            $i++
        }

        # Write interactable specific actions to screen.
        Write-WordWrapHost "So... what now?" -Color Magenta
        Write-Host

        foreach ($Number in $CodeLockOptions.Keys | Sort-Object) {
            Write-Host "$Number`: $($CodeLockOptions.$Number.MenuDescription)"
        }
        Write-Host

        # Read player action.
        $PlayerInput = $null
        while (('1', '2', '3', '4', '5', '6', '7', '8', '9') -notcontains $PlayerInput) {
            $PlayerInput = Read-Host "What would you like to do?"
        }
        [int]$PlayerInput = $PlayerInput

        # Process player action.
        if ((@(1..9) -contains $PlayerInput -and $PlayerInput -le $CodeLockOptions.Count)) {
            if ($CodeLockOptions.$PlayerInput.MenuDescription -eq "Enter a four digit code.") {
                $Script:ActionMessage = $CodeLockOptions.$PlayerInput.ActionMessage
                $AttemptCounter++
                $Code = Read-Host Enter code
                if ($Code -eq "1988") {
                    $Script:ActionMessage = "The light on the lock turns green and you hear a click. You did it! The door is unlocked now."
                    $Script:MachineState = "Completed"
                    $World.'504850'.Exits.West.LockedDoor = $false                
                    $World.'494850'.Exits.East.LockedDoor = $false                
                }
                else {
                    $Script:ActionMessage = "The red light on the lock flickers and emits a buzzing sound. Apparantly, that was the wrong code."
                    $Script:MachineState = "Running"
                }
                $interactableData.Remove("SendEmail")
            }
            elseif ($CodeLockOptions.$PlayerInput.MenuDescription -eq "Walk away from the code lock.") {
                $Script:ActionMessage = $CodeLockOptions.$PlayerInput.ActionMessage
                $Script:MachineState = "Completed"
            }
        }
        else {
            $Script:ActionMessage = "Invalid choice. Try again"
            $Script:MachineState = "Running"
        }

        # End the game if the player spends too much time at the PC.
        if ($AttemptCounter -ge 3) {
            Write-wordwrapHost "Someone looks up at you, realizes what you are doing and calls you out! This is probably the end of your assignment..." -Color Green
            Start-Sleep -Seconds 5
            $Script:MachineState = "Completed"
            $Script:EndScenario = "Caught"
            $Script:GameState = "Quit"
        }
    }
}